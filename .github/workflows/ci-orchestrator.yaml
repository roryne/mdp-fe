name: CI Orchestrator

concurrency:
  group: orchestrator-${{ github.ref }}
  cancel-in-progress: true

on:
  pull_request:
    branches: [main]
  workflow_dispatch:

jobs:
  setup:
    uses: ./.github/workflows/action-project-setup.yaml
    with:
      install-playwright: true

  code-quality:
    needs: setup
    uses: ./.github/workflows/action-code-quality.yaml

  component-tests:
    needs: setup
    uses: ./.github/workflows/action-run-component-tests.yaml
    with:
      # Run only-changed tests unless this is a PR approval
      event-name: ${{ github.event_name }}
      review-state: ${{ github.event.review.review_state || '' }}
