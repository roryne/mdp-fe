name: CI Orchestrator

concurrency:
  group: orchestrator-${{ github.ref }}
  cancel-in-progress: true

on:
  pull_request:
    branches: [main]
  workflow_dispatch:

jobs:
  setup:
    uses: ./.github/workflows/action-project-setup.yaml
    with:
      install-playwright: true

  code-quality:
    needs: setup
    uses: ./.github/workflows/action-code-quality.yaml

  component-tests:
    needs: setup
    uses: ./.github/workflows/action-run-component-tests.yaml
    with:
      # Run only-changed tests unless this is a PR approval
      only-changed: ${{ github.event_name == 'pull_request' && github.event.review.state != 'approved' }}
